%-------------------------------------------------------------
% 5 Section Headers

% 5.0 Spacings
\newcommand{\chapterpagepadding}[0]{7mm}
\newcommand{\sectionheaderspaceA}{1mm}
\newcommand{\sectionheaderspaceB}{4mm}
\newcommand{\sectionheaderspaceC}{2mm}
\newcommand{\sectionheaderspaceD}{6mm}
\newcommand{\setupfont}
    {\normalfont\LARGE\bfseries\fontfamily{phv}\selectfont}
\newcommand{\setupfontsectionexercises}
    {\normalfont\bfseries\fontfamily{phv}\selectfont}
\newcommand{\setfontsize}[1]{\fontsize{#1}{#1}\selectfont}

% 5.1 Chapter
\newcommand{\titlebreak}[1][5mm]{\\[#1]}
\newcommand{\chaptertitle}[2][\chaptertitlefontsize]{{\color{white}\titlerule[1.5mm]}\addvspace{\sectionheaderspaceB}
    {\setupfont{}\color{chaptertitlegray}\setfontsize{#1}#2} \\[2mm]
        {\color{white}\titlerule[1.5mm]}

~\vspace{15mm}

}
\titleformat{\chapter}[display]
{\color{oiB}\normalfont\Huge\bfseries\raggedright}{\chaptertitlename\
\thechapter}{20pt}{{\setupfont{}\Huge #1}}
\newenvironment{chapterpage}[1]{
%\newpage
\noindent\begin{fullminipage}[left=\chapterpagepadding{},right=\chapterpagepadding{},top=\chapterpagepadding{},bottom=\chapterpagepadding{},bgcolor=seaBackground]
%\noindent\rule{\textwidth}{0.3pt}\vspace{-6mm}
\begin{mdframed}[%
    topline=false,
    rightline=false,
    leftline=false,
    bottomline=false,
    innerleftmargin=\chapterpagepaddinginner{},
    innerrightmargin=\chapterpagepaddingrightinner{},
    innertopmargin=\chapterpagepaddingtopinner{},
    innerbottommargin=\chapterpagepaddinginner{},
    backgroundcolor=seaBackground]
\chapter{#1}%{\pagewidth-10mm}
%\textbf{\color{oiB}\small\fontfamily{phv}%
%\selectfont{\MakeUppercase{#1}}} \\[1mm]
}{
\end{mdframed}
%\rule{\textwidth}{0.3pt}
\end{fullminipage}}
\titleformat{\chapter}
    {}
    {\setupfont{}\setfontsize{\chapterXfontsize}\color{oiB}Chapter~\thechapter}% \quad #1}
    {1em}
    {}
    []
\titlespacing{\chapter}
   {0pt}% left
   {0pt}% before sep
   {\baselineskip}% after sep% 5.3 Subsection
\newcommand{\chaptersection}[1]{\Large\fontfamily{phv}%
\selectfont\textbf{\ref{#1}~\nameref{#1}} \\[4mm]}

% 5.1.1 Chapter introduction
\newcommand{\chapterintro}[1]{
  %\fancyhead[RO,LE]{\thepage}
  \fancyhead[RE]{}
  \fancyhead[LO]{}

  ~\vspace{25mm}

  {\color{oiB}\titlerule[1.5mm]}\addvspace{7mm}

  {\Large
  \begingroup\onehalfspacing
  \noindent%
  #1\vspace{7mm}\par
  \endgroup}

  {\color{oiB}\titlerule[0.5mm]}

  \vfill

  \noindent%
  \oiRedirect{stat}{\includegraphics[height=10mm]{extraTeX/icons/video_and_slides.png}}
  \vspace{5mm}

  {\color{oiB}\titlerule[0.5mm]}
  
  ~\vspace{5mm}
  
  {\Large\noindent%
  For videos, slides, and other resources, please visit \\[2mm]
  \oiRedirect{os}{\textbf{\color{oiB}www.openintro.org/os}}}%
      \vspace{5mm}

  ~\newpage
  %\fancyhead[RO,LE]{\thepage}
  \fancyhead[RE]{\leftmark}
  \fancyhead[LO]{\rightmark}
}

% 5.2 Section
\newcommand{\clearpageforsection}{\clearpage}
\let\oldsection\section
\renewcommand\section{\clearpageforsection\oldsection}
\titleformat{\section}
    {{\color{oiR}\titlerule[1mm]}\addvspace{\sectionheaderspaceA}\color{oiB}\setupfont{}}
    {\color{oiB}\thesection \quad #1}
    {1em}
    {}
    [{\color{oiR}\titlerule[1mm]}\addvspace{4mm}]
\titlespacing{\section}
   {0pt}% left
   {0pt}% before sep
   {\baselineskip}% after sep% 5.3 Subsection
\titleformat{\subsection}
    {{\color{grayDark}\titlerule[0.1mm]}\vspace{2mm}\color{oiB}\normalfont\large%
        \bfseries\fontfamily{phv}%
        \selectfont}
    {\color{oiB}\thesubsection}
    {1em}
    {#1}
\titlespacing{\subsection}
   {0pt}% left
   {8mm}% before sep
   {\baselineskip}% after sep% 5.3 Subsection


% 5.4 Section Introduction
\newcommand{\sectionintro}[1]{\begin{spacing}{1.1}\large
#1
\end{spacing}}
\newcommand{\nsubsection}[1]{\subsection{\MakeUppercase{#1}}}


% 5.5 Review Exercises
\newcommand{\reviewexercisesheader}[1][Chapter exercises]
  {
    \clearpageforsection
    {{\color{oiR}\titlerule[1mm]}%
        \vspace*{\sectionheaderspaceC}
    \noindent\setupfont{}\color{oiB}#1 \\[-1mm]
    {\color{oiR}\titlerule[1mm]} \\[2mm]
    }
}
\newcommand{\exercisesheader}[1][Exercises]
  {
    \clearpageforsection
    {{\color{oiR}\titlerule[1.0mm]}%
        \vspace*{\sectionheaderspaceC}
    \noindent\setupfont{}\large\color{oiB}\textbf{#1}
    } \vspace*{\sectionheaderspaceD{}}
  }
