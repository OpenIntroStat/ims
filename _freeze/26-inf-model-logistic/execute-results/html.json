{
  "hash": "bc1acdf30e6161923dba01ef3ee18fec",
  "result": {
    "engine": "knitr",
    "markdown": "# Inference for logistic regression {#sec-inf-model-logistic}\n\n\n\n\n\n::: {.chapterintro data-latex=\"\"}\nCombining ideas from [Chapter -@sec-model-logistic] on logistic regression, [Chapter -@sec-foundations-mathematical] on inference with mathematical models, and [Chapter -@sec-inf-model-slr] and [Chapter -@sec-inf-model-mlr] which apply inferential techniques to the linear model, we wrap up the book by considering inferential methods applied to a logistic regression model.\nAdditionally, we use cross-validation as a method for independent assessment of the logistic regression model.\n:::\n\n\n\n\n\nAs with multiple linear regression, the inference aspect for logistic regression will focus on interpretation of coefficients and relationships between explanatory variables.\nBoth p-values and cross-validation will be used for assessing a logistic regression model.\n\nConsider the `email` data which describes email characteristics which can be used to predict whether a particular incoming email is (unsolicited bulk email).\nWithout reading every incoming message, it might be nice to have an automated way to identify spam emails.\nWhich of the variables describing each email are important for predicting the status of the email?\n\n::: {.data data-latex=\"\"}\nThe [`email`](http://openintrostat.github.io/openintro/reference/email.html) data can be found in the [**openintro**](http://openintrostat.github.io/openintro) R package.\n:::\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Variables and their descriptions for the `email` dataset. Many of the variables are indicator variables, meaning they take the value 1 if the specified characteristic is present and 0 otherwise.</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Variable </th>\n   <th style=\"text-align:left;\"> Description </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> spam </td>\n   <td style=\"text-align:left;width: 30em; \"> Indicator for whether the email was spam. </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> to_multiple </td>\n   <td style=\"text-align:left;width: 30em; \"> Indicator for whether the email was addressed to more than one recipient. </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> from </td>\n   <td style=\"text-align:left;width: 30em; \"> Whether the message was listed as from anyone (this is usually set by default for regular outgoing email). </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> cc </td>\n   <td style=\"text-align:left;width: 30em; \"> Number of people cc'ed. </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> sent_email </td>\n   <td style=\"text-align:left;width: 30em; \"> Indicator for whether the sender had been sent an email in the last 30 days. </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> attach </td>\n   <td style=\"text-align:left;width: 30em; \"> The number of attached files. </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> dollar </td>\n   <td style=\"text-align:left;width: 30em; \"> The number of times a dollar sign or the word “dollar” appeared in the email. </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> winner </td>\n   <td style=\"text-align:left;width: 30em; \"> Indicates whether “winner” appeared in the email. </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> format </td>\n   <td style=\"text-align:left;width: 30em; \"> Indicates whether the email was written using HTML (e.g., may have included bolding or active links). </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> re_subj </td>\n   <td style=\"text-align:left;width: 30em; \"> Whether the subject started with “Re:”, “RE:”, “re:”, or “rE:” </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> exclaim_subj </td>\n   <td style=\"text-align:left;width: 30em; \"> Whether there was an exclamation point in the subject. </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> urgent_subj </td>\n   <td style=\"text-align:left;width: 30em; \"> Whether the word “urgent” was in the email subject. </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> exclaim_mess </td>\n   <td style=\"text-align:left;width: 30em; \"> The number of exclamation points in the email message. </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-family: monospace;\"> number </td>\n   <td style=\"text-align:left;width: 30em; \"> Factor variable saying whether there was no number, a small number (under 1 million), or a big number. </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Model diagnostics\n\nBefore looking at the hypothesis tests associated with the coefficients (turns out they are very similar to those in linear regression!), it is valuable to understand the technical conditions that underlie the inference applied to the logistic regression model.\nGenerally, as you've seen in the logistic regression modeling examples, it is imperative that the response variable is binary.\nAdditionally, the key technical condition for logistic regression has to do with the relationship between the predictor variables $(x_i$ values) and the probability the outcome will be a success.\nIt turns out, the relationship is a specific functional form called a logit function, where ${\\rm logit}(p) = \\log_e(\\frac{p}{1-p}).$ The function may feel complicated, and memorizing the formula of the logit is not necessary for understanding logistic regression.\nWhat you do need to remember is that the probability of the outcome being a success is a function of a linear combination of the explanatory variables.\n\n::: {.important data-latex=\"\"}\n**Logistic regression conditions.**\n\nThere are two key conditions for fitting a logistic regression model:\n\n1.  Each outcome $Y_i$ is independent of the other outcomes.\n2.  Each predictor $x_i$ is linearly related to logit$(p_i)$ if all other predictors are held constant.\n:::\n\n\n\n\n\nThe first logistic regression model condition --- independence of the outcomes --- is reasonable if we can assume that the emails that arrive in an inbox within a few months are independent of each other with respect to whether they're spam or not.\n\nThe second condition of the logistic regression model is not easily checked without a fairly sizable amount of data.\nLuckily, we have 3921 emails in the dataset!\nLet's first visualize these data by plotting the true classification of the emails against the model's fitted probabilities, as shown in Figure \\@ref(fig:spam-predict).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![The predicted probability that each of the 3921 emails that are spam. Points have been jittered so that those with nearly identical values aren’t plotted exactly on top of one another.](26-inf-model-logistic_files/figure-html/spam-predict-1.png){width=90%}\n:::\n:::\n\n\nWe'd like to assess the quality of the model.\nFor example, we might ask: if we look at emails that we modeled as having 10% chance of being spam, do we find out 10% of the actually are spam?\nWe can check this for groups of the data by constructing a plot as follows:\n\n1.  Bucket the data into groups based on their predicted probabilities.\n2.  Compute the average predicted probability for each group.\n3.  Compute the observed probability for each group, along with a 95% confidence interval for the true probability of success for those individuals.\n4.  Plot the observed probabilities (with 95% confidence intervals) against the average predicted probabilities for each group.\n\nIf the model does a good job describing the data, the plotted points should fall close to the line $y = x$, since the predicted probabilities should be similar to the observed probabilities.\nWe can use the confidence intervals to roughly gauge whether anything might be amiss.\nSuch a plot is shown in Figure \\@ref(fig:logisticModelBucketDiag).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![(ref:logisticModelBucketDiag-cap)](26-inf-model-logistic_files/figure-html/logisticModelBucketDiag-1.png){width=90%}\n:::\n:::\n\n\n(ref:logisticModelBucketDiag-cap) The dashed line is within the confidence bound of the 95% confidence intervals of each of the buckets, suggesting the logistic fit is reasonable.\n\nA plot like Figure \\@ref(fig:logisticModelBucketDiag) helps to better understand the deviations.\nAdditional diagnostics may be created that are similar to those featured in Section \\@ref(tech-cond-linmod).\nFor instance, we could compute residuals as the observed outcome minus the expected outcome ($e_i = Y_i - \\hat{p}_i$), and then we could create plots of these residuals against each predictor.\n\n\\index{logistic regression}\n\n## Multiple logistic regression output from software {#sec-inf-log-reg-soft}\n\nAs you learned in Chapter \\@ref(model-mlr), optimization can be used to find the coefficient estimates for the logistic model.\nThe unknown population model can be written as:\n\n$$\n\\begin{aligned}\n\\log_e\\bigg(\\frac{p}{1-p}\\bigg) &= \\beta_0 + \\beta_1 \\times \\texttt{to_multiple} + \\beta_2 \\times \\texttt{cc} \\\\\n&+ \\beta_3 \\times \\texttt{dollar} + \\beta_4 \\times \\texttt{urgent_subj}\n\\end{aligned}\n$$\n\nThe estimated equation for the regression model may be written as a model with four predictor variables (where $\\hat{p}$ is the estimated probability of being a spam email message):\n\n$$\n\\begin{aligned}\n\\log_e\\bigg(\\frac{\\hat{p}}{1-\\hat{p}}\\bigg) &= -2.05 + -1.91 \\times \\texttt{to_multiple} + 0.02 \\times \\texttt{cc} \\\\\n&- 0.07 \\times \\texttt{dollar} + 2.66 \\times \\texttt{urgent_subj}\n\\end{aligned}\n$$\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Summary of a logistic model for predicting whether an email is spam based on the variables `to_multiple`, `cc`, `dollar`, and `urgent_subj`. Each of the variables has its own coefficient estimate and p-value.</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> (Intercept) </td>\n   <td style=\"text-align:right;width: 5em; \"> -2.05 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.06 </td>\n   <td style=\"text-align:right;width: 5em; \"> -34.67 </td>\n   <td style=\"text-align:right;width: 5em; \"> &lt;0.0001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> to_multiple1 </td>\n   <td style=\"text-align:right;width: 5em; \"> -1.91 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.30 </td>\n   <td style=\"text-align:right;width: 5em; \"> -6.37 </td>\n   <td style=\"text-align:right;width: 5em; \"> &lt;0.0001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> cc </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.02 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.02 </td>\n   <td style=\"text-align:right;width: 5em; \"> 1.16 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.245 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> dollar </td>\n   <td style=\"text-align:right;width: 5em; \"> -0.07 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.02 </td>\n   <td style=\"text-align:right;width: 5em; \"> -3.38 </td>\n   <td style=\"text-align:right;width: 5em; \"> 7e-04 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> urgent_subj1 </td>\n   <td style=\"text-align:right;width: 5em; \"> 2.66 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.80 </td>\n   <td style=\"text-align:right;width: 5em; \"> 3.32 </td>\n   <td style=\"text-align:right;width: 5em; \"> 9e-04 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nNot only does Table \\@ref(tab:emaillogmodel) provide the estimates for the coefficients, it also provides information on the inference analysis (i.e., hypothesis testing) which are the focus of this chapter.\n\nAs in Section \\@ref(inf-model-mlr), with **multiple predictors**, each hypothesis test (for each of the explanatory variables) is conditioned on each of the other variables remaining in the model.\n\n\n\n\n\n> if multiple predictors $H_0: \\beta_i = 0$ given other variables in the model\n\nUsing the example above and focusing on each of the variable p-values (here we won't discuss the p-value associated with the intercept), we can write out the four different hypotheses (associated with the p-value corresponding to each of the coefficients / row in Table \\@ref(tab:emaillogmodel)):\n\n-   $H_0: \\beta_1 = 0$ given `cc`, `dollar`, and `urgent_subj` are included in the model\n-   $H_0: \\beta_2 = 0$ given `to_multiple`, `dollar`, and `urgent_subj` are included in the model\n-   $H_0: \\beta_3 = 0$ given `to_multiple`, `cc`, and `urgent_subj` are included in the model\n-   $H_0: \\beta_4 = 0$ given `to_multiple`, `dollar`, and `dollar` are included in the model\n\nThe very low p-values from the software output tell us that three of the variables (that is, not `cc`) act as statistically discernible predictors in the model at the discernibility level of 0.05, despite the inclusion of any of the other variables.\nConsider the p-value on $H_0: \\beta_1 = 0$.\nThe low p-value says that it would be extremely unlikely to observe data that yield a coefficient on `to_multiple` at least as far from 0 as -1.91 (i.e. $|b_1| > 1.91$) if the true relationship between `to_multiple` and `spam` was non-existent (i.e., if $\\beta_1 = 0$) **and** the model also included `cc` and `dollar` and `urgent_subj`.\nNote also that the coefficient on `dollar` has a small associated p-value, but the magnitude of the coefficient is also seemingly small (0.07).\nIt turns out that in units of standard errors (0.02 here), 0.07 is actually quite far from zero, it's all about context!\nThe p-values on the remaining variables are interpreted similarly.\nFrom the initial output (p-values) in Table \\@ref(tab:emaillogmodel), it seems as though `to_multiple`, `dollar`, and `urgent_subj` are important variables for modeling whether an email is `spam`.\nWe remind you that although p-values provide some information about the importance of each of the predictors in the model, there are many, arguably more important, aspects to consider when choosing the best model.\n\nAs with linear regression (see Section \\@ref(inf-mult-reg-collin)), existence of predictors that are correlated with each other can affect both the coefficient estimates and the associated p-values.\nHowever, investigating multicollinearity in a logistic regression model is saved for a text which provides more detail about logistic regression.\nNext, as a model building alternative (or enhancement) to p-values, we revisit cross-validation within the context of predicting status for each of the individual emails.\n\n## Cross-validation for prediction error {#sec-inf-log-reg-cv}\n\nThe p-value is a probability measure under a setting of no relationship.\nThat p-value provides information about the degree of the relationship (e.g., above we measure the relationship between `spam` and `to_multiple` using a p-value), but the p-value does not measure how well the model will predict the individual emails (e.g., the accuracy of the model).\nDepending on the goal of the research project, you might be inclined to focus on variable importance (through p-values) or you might be inclined to focus on prediction accuracy (through cross-validation).\n\nHere we present a method for using cross-validation accuracy to determine which variables (if any) should be used in a model which predicts whether an email is spam.\nA full treatment of cross-validation and logistic regression models is beyond the scope of this text.\nUsing cross-validation, we can build $k$ different models which are used to predict the observations in each of the $k$ holdout samples.\nThe smaller model uses only the `to_multiple` variable, see the complete dataset (not cross-validated) model output in Table \\@ref(tab:emaillogmodel1).\nThe logistic regression model can be written as (where $\\hat{p}$ is the estimated probability of being a spam email message):\n\n\n\n\n\n$$\\log_e\\bigg(\\frac{\\hat{p}}{1-\\hat{p}}\\bigg) =  -2.12 + -1.81 \\times \\texttt{to_multiple}$$\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Summary of a logistic model for predicting whether an email is spam based on only the predictor variable `to_multiple`. Each of the variables has its own coefficient estimate and p-value.</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> (Intercept) </td>\n   <td style=\"text-align:right;width: 5em; \"> -2.12 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.06 </td>\n   <td style=\"text-align:right;width: 5em; \"> -37.67 </td>\n   <td style=\"text-align:right;width: 5em; \"> &lt;0.0001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> to_multiple1 </td>\n   <td style=\"text-align:right;width: 5em; \"> -1.81 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.30 </td>\n   <td style=\"text-align:right;width: 5em; \"> -6.09 </td>\n   <td style=\"text-align:right;width: 5em; \"> &lt;0.0001 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nFor each cross-validated model, the coefficients change slightly, and the model is used to make independent predictions on the holdout sample.\nThe model from the first cross-validation sample is given in Table \\@ref(fig:emailCV1) and can be compared to the coefficients in Table \\@ref(tab:emaillogmodel1).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![The coefficients are estimated using the least squares model on 3/4 of the dataset with a single predictor variable. Predictions are made on the remaining 1/4 of the observations. Note that the predictions are independent of the estimated model coefficients, and the prediction error rate is quite high.](images/emailCV1.png){fig-alt='The left panel shows the logistic model predicting the probability of an email being spam as a function of whether the email was sent to multiple individuals; the model was built using the red, green, and yellow triangular sections of the observed data. The right panel shows a confusion matrix of the predicted spam label crossed with the observed spam label for the set of observations in the blue triangular section of the observed data. Of the 83 spam emails, 80 were correctly classified as spam. Of the 897 non-spam emails, 143 were correctly classified as not spam.' width=100%}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>One quarter at a time, the data were removed from the model building, and whether the email was spam (TRUE) or not (FALSE) was predicted. The logistic regression model was fit independently of the removed emails. Only `to_multiple` is used to predict whether the email is spam. Because we used a cutoff designed to identify spam emails, the accuracy of the non-spam email predictions is very low.</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> fold </th>\n   <th style=\"text-align:right;\"> count </th>\n   <th style=\"text-align:right;\"> accuracy </th>\n   <th style=\"text-align:right;\"> notspamTP </th>\n   <th style=\"text-align:right;\"> spamTP </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 1st quarter </td>\n   <td style=\"text-align:right;\"> 980 </td>\n   <td style=\"text-align:right;\"> 0.26 </td>\n   <td style=\"text-align:right;\"> 0.19 </td>\n   <td style=\"text-align:right;\"> 0.98 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 2nd quarter </td>\n   <td style=\"text-align:right;\"> 981 </td>\n   <td style=\"text-align:right;\"> 0.23 </td>\n   <td style=\"text-align:right;\"> 0.15 </td>\n   <td style=\"text-align:right;\"> 0.96 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 3rd quarter </td>\n   <td style=\"text-align:right;\"> 979 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 0.18 </td>\n   <td style=\"text-align:right;\"> 0.96 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 4th quarter </td>\n   <td style=\"text-align:right;\"> 981 </td>\n   <td style=\"text-align:right;\"> 0.24 </td>\n   <td style=\"text-align:right;\"> 0.17 </td>\n   <td style=\"text-align:right;\"> 0.98 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nBecause the `email` dataset has a ratio of roughly 90% non-spam and 10% spam emails, a model which randomly guessed all non-spam would have an overall accuracy of 90%!\nClearly, we would like to capture the information with the spam emails, so our interest is in the percent of spam emails which are identified as spam (see Table \\@ref(tab:email-spam)).\nAdditionally, in the logistic regression model, we use a 10% cutoff to predict whether the email is spam.\nFortunately, we have done a great job of predicting !\nHowever, the trade-off was that most of the non-spam emails are now predicted to be which is not acceptable for a prediction algorithm.\nAdding more variables to the model may help with both the spam and non-spam predictions.\n\nThe larger model uses `to_multiple`, `attach`, `winner`, `format`, `re_subj`, `exclaim_mess`, and `number` as the set of seven predictor variables, see the complete dataset (not cross-validated) model output in Table \\@ref(tab:emaillogmodel2).\nThe logistic regression model can be written as (where $\\hat{p}$ is the estimated probability of being a spam email message):\n\n$$\n\\begin{aligned}\n\\log_e\\bigg(\\frac{\\hat{p}}{1-\\hat{p}}\\bigg) = -0.34 &- 2.56 \\times \\texttt{to_multiple} + 0.20 \\times \\texttt{attach} \\\\\n&+ 1.73 \\times \\texttt{winner}_{yes} - 1.28 \\times \\texttt{format} \\\\\n&- 2.86 \\times \\texttt{re_subj} + 0 \\times \\texttt{exclaim_mess} \\\\\n&- 1.07 \\times \\texttt{number}_{small} - 0.42 \\times \\texttt{number}_{big}\n\\end{aligned}\n$$\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Summary of a logistic model for predicting whether an email is spam based on only the predictor variable `to_multiple`. Each of the variables has its own coefficient estimate and p-value.</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> (Intercept) </td>\n   <td style=\"text-align:right;width: 5em; \"> -0.34 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.11 </td>\n   <td style=\"text-align:right;width: 5em; \"> -3.02 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.0025 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> to_multiple1 </td>\n   <td style=\"text-align:right;width: 5em; \"> -2.56 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.31 </td>\n   <td style=\"text-align:right;width: 5em; \"> -8.28 </td>\n   <td style=\"text-align:right;width: 5em; \"> &lt;0.0001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> attach </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.20 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.06 </td>\n   <td style=\"text-align:right;width: 5em; \"> 3.29 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> winneryes </td>\n   <td style=\"text-align:right;width: 5em; \"> 1.73 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.33 </td>\n   <td style=\"text-align:right;width: 5em; \"> 5.33 </td>\n   <td style=\"text-align:right;width: 5em; \"> &lt;0.0001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> format1 </td>\n   <td style=\"text-align:right;width: 5em; \"> -1.28 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.13 </td>\n   <td style=\"text-align:right;width: 5em; \"> -9.80 </td>\n   <td style=\"text-align:right;width: 5em; \"> &lt;0.0001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> re_subj1 </td>\n   <td style=\"text-align:right;width: 5em; \"> -2.86 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.37 </td>\n   <td style=\"text-align:right;width: 5em; \"> -7.83 </td>\n   <td style=\"text-align:right;width: 5em; \"> &lt;0.0001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> exclaim_mess </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.00 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.00 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.26 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.7925 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> numbersmall </td>\n   <td style=\"text-align:right;width: 5em; \"> -1.07 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.14 </td>\n   <td style=\"text-align:right;width: 5em; \"> -7.54 </td>\n   <td style=\"text-align:right;width: 5em; \"> &lt;0.0001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 15em; font-family: monospace;\"> numberbig </td>\n   <td style=\"text-align:right;width: 5em; \"> -0.42 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.20 </td>\n   <td style=\"text-align:right;width: 5em; \"> -2.10 </td>\n   <td style=\"text-align:right;width: 5em; \"> 0.0357 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![The coefficients are estimated using the least squares model on 3/4 of the dataset with the seven specified predictor variables. Predictions are made on the remaining 1/4 of the observations. Note that the predictions are independent of the estimated model coefficients. The predictions are now much better for both the  and the non-spam emails (than they were with a single predictor variable).](images/emailCV2.png){fig-alt='The left panel shows the logistic model predicting the probability of an email being spam as a function of the email being sent to multiple recipients, number of attachments, using the word winner, format of HTML, RE in the subject line, number of exclamation points in the message, and the existence of a number in the email; the model was built using the red, green, and yellow triangular sections of the observed data. The right panel shows a confusion matrix of the predicted spam label crossed with the observed spam label for the set of observations in the blue triangular section of the observed data. Of the 97 spam emails, 73 were correctly classified as spam. Of the 883 non-spam emails, 688 were correctly classified as not spam.' width=100%}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>One quarter at a time, the data were removed from the model building, and whether the email was spam (TRUE) or not (FALSE) was predicted. The logistic regression model was fit independently of the removed emails. Now, the variables `to_multiple`, `attach`, `winner`, `format`, `re_subj`, `exclaim_mess`, and `number` are used to predict whether the email is spam.</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> fold </th>\n   <th style=\"text-align:right;\"> count </th>\n   <th style=\"text-align:right;\"> accuracy </th>\n   <th style=\"text-align:right;\"> notspamTP </th>\n   <th style=\"text-align:right;\"> spamTP </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 1st quarter </td>\n   <td style=\"text-align:right;\"> 980 </td>\n   <td style=\"text-align:right;\"> 0.77 </td>\n   <td style=\"text-align:right;\"> 0.77 </td>\n   <td style=\"text-align:right;\"> 0.71 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 2nd quarter </td>\n   <td style=\"text-align:right;\"> 981 </td>\n   <td style=\"text-align:right;\"> 0.80 </td>\n   <td style=\"text-align:right;\"> 0.81 </td>\n   <td style=\"text-align:right;\"> 0.70 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 3rd quarter </td>\n   <td style=\"text-align:right;\"> 979 </td>\n   <td style=\"text-align:right;\"> 0.76 </td>\n   <td style=\"text-align:right;\"> 0.77 </td>\n   <td style=\"text-align:right;\"> 0.65 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 4th quarter </td>\n   <td style=\"text-align:right;\"> 981 </td>\n   <td style=\"text-align:right;\"> 0.78 </td>\n   <td style=\"text-align:right;\"> 0.79 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nSomewhat expected, the larger model (see Table \\@ref(tab:email-spam2)) was able to capture more nuance in the emails which lead to better predictions.\nHowever, it is not true that adding variables will always lead to better predictions, as correlated or noise variables may dampen the signal from those variables which truly predict the status.\nWe encourage you to learn more about multiple variable models and cross-validation in your future exploration of statistical topics.\n\n\\clearpage\n\n## Chapter review {#sec-chp27-review}\n\n### Summary\n\nThroughout the text, we have presented a modern view to introduction to statistics.\nEarly we presented graphical techniques which communicated relationships across multiple variables.\nWe also used modeling to formalize the relationships.\nIn Chapter \\@ref(inf-model-logistic) we considered inferential claims on models which include many variables used to predict the probability of the outcome being a success.\nWe continue to emphasize the importance of experimental design in making conclusions about research claims.\nIn particular, recall that variability can come from different sources (e.g., random sampling vs. random allocation, see Figure \\@ref(fig:randsampValloc)).\n\nAs you might guess, this text has only scratched the surface of the world of statistical analyses that can be applied to different datasets.\nIn particular, to do justice to the topic, the linear models and generalized linear models we have introduced can each be covered with their own course or book.\nHierarchical models, alternative methods for fitting parameters (e.g., Ridge Regression or LASSO), and advanced computational methods applied to models (e.g., permuting the response variable? one explanatory variable? all the explanatory variables?) are all beyond the scope of this book.\nHowever, your successful understanding of the ideas we have covered has set you up perfectly to move on to a higher level of statistical modeling and inference.\nEnjoy!\n\n### Terms\n\nWe introduced the following terms in the chapter.\nIf you're not sure what some of these terms mean, we recommend you go back in the text and review their definitions.\nWe are purposefully presenting them in alphabetical order, instead of in order of appearance, so they will be a little more challenging to locate.\nHowever, you should be able to easily spot them as **bolded text**.\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> cross-validation </td>\n   <td style=\"text-align:left;\"> multiple predictors </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> inference on logistic regression </td>\n   <td style=\"text-align:left;\"> technical conditions </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\\clearpage\n\n## Exercises {#sec-chp26-exercises}\n\nAnswers to odd-numbered exercises can be found in [Appendix -@sec-exercise-solutions-26].\n\n::: {.exercises data-latex=\"\"}\n1. **Marijuana use in college.** \nResearchers studying whether the value systems adolescents conflict with those of their children asked 445 college students if they use marijuana. They also asked the students' parents if they've used marijuana when they were in college.\nThe following model was fit to predict student drug use from parent drug use.^[The [`drug_use`](http://openintrostat.github.io/openintro/reference/drug_use.html) data used in this exercise can be found in the [**openintro**](http://openintrostat.github.io/openintro) R package.] [@Ellis:1979]\n\n    ::: {.cell}\n    ::: {.cell-output-display}\n    `````{=html}\n    <table class=\"table table-striped table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n     <thead>\n      <tr>\n       <th style=\"text-align:left;\"> term </th>\n       <th style=\"text-align:right;\"> estimate </th>\n       <th style=\"text-align:right;\"> std.error </th>\n       <th style=\"text-align:right;\"> statistic </th>\n       <th style=\"text-align:right;\"> p.value </th>\n      </tr>\n     </thead>\n    <tbody>\n      <tr>\n       <td style=\"text-align:left;width: 10em; font-family: monospace;\"> (Intercept) </td>\n       <td style=\"text-align:right;width: 5em; \"> -0.405 </td>\n       <td style=\"text-align:right;width: 5em; \"> 0.133 </td>\n       <td style=\"text-align:right;width: 5em; \"> -3.04 </td>\n       <td style=\"text-align:right;width: 5em; \"> 0.0023 </td>\n      </tr>\n      <tr>\n       <td style=\"text-align:left;width: 10em; font-family: monospace;\"> parentsused </td>\n       <td style=\"text-align:right;width: 5em; \"> 0.791 </td>\n       <td style=\"text-align:right;width: 5em; \"> 0.194 </td>\n       <td style=\"text-align:right;width: 5em; \"> 4.09 </td>\n       <td style=\"text-align:right;width: 5em; \"> &lt;0.0001 </td>\n      </tr>\n    </tbody>\n    </table>\n    \n    `````\n    :::\n    :::\n\n    a. State the hypotheses for evaluating whether parents' marijuana usage is a discernible predictor of their kids' marijuana usage.\n    \n    b. Based on the regression output, state the sample statistic and the p-value of the test.\n    \n    c. State the conclusion of the hypothesis test in context of the data and the research question.\n\n1. **Treating heart attacks.**\nResearchers studying the effectiveness of Sulfinpyrazone in the prevention of sudden death after a heart attack conducted a randomized experiment on 1,475 patients. \nThe following model was fit to predict experiment outcome (`died` or `lived`, where success is defined as `lived`) from the experimental group (`control` and `treatment`).^[The [`sulphinpyrazone`](http://openintrostat.github.io/openintro/reference/sulphinpyrazone.html) data used in this exercise can be found in the [**openintro**](http://openintrostat.github.io/openintro) R package.] [@Anturane:1980]\n\n    ::: {.cell}\n    ::: {.cell-output-display}\n    `````{=html}\n    <table class=\"table table-striped table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n     <thead>\n      <tr>\n       <th style=\"text-align:left;\"> term </th>\n       <th style=\"text-align:right;\"> estimate </th>\n       <th style=\"text-align:right;\"> std.error </th>\n       <th style=\"text-align:right;\"> statistic </th>\n       <th style=\"text-align:right;\"> p.value </th>\n      </tr>\n     </thead>\n    <tbody>\n      <tr>\n       <td style=\"text-align:left;width: 10em; font-family: monospace;\"> (Intercept) </td>\n       <td style=\"text-align:right;width: 5em; \"> 2.431 </td>\n       <td style=\"text-align:right;width: 5em; \"> 0.135 </td>\n       <td style=\"text-align:right;width: 5em; \"> 18.05 </td>\n       <td style=\"text-align:right;width: 5em; \"> &lt;0.0001 </td>\n      </tr>\n      <tr>\n       <td style=\"text-align:left;width: 10em; font-family: monospace;\"> grouptreatment </td>\n       <td style=\"text-align:right;width: 5em; \"> 0.395 </td>\n       <td style=\"text-align:right;width: 5em; \"> 0.210 </td>\n       <td style=\"text-align:right;width: 5em; \"> 1.89 </td>\n       <td style=\"text-align:right;width: 5em; \"> 0.0594 </td>\n      </tr>\n    </tbody>\n    </table>\n    \n    `````\n    :::\n    :::\n\n    a. State the hypotheses for evaluating whether experimental group is a discernible predictor of treatment outcome.\n    \n    b. Based on the regression output, state the sample statistic and the p-value of the test.\n    \n    c. State the conclusion of the hypothesis test in context of the data and the research question.\n    \n    \\clearpage\n\n1. **Possum classification, cross-validation.** \nThe common brushtail possum of the Australia region is a bit cuter than its distant cousin, the American opossum.\nWe consider 104 brushtail possums from two regions in Australia, where the possums may be considered a random sample from the population.\nThe first region is Victoria, which is in the eastern half of Australia and traverses the southern coast. \nThe second region consists of New South Wales and Queensland, which make up eastern and northeastern Australia. \nWe use logistic regression to differentiate between possums in these two regions.\nThe outcome variable, called `pop`, takes value 1 when a possum is from Victoria and 0 when it is from New South Wales or Queensland.^[The [`possum`](http://openintrostat.github.io/openintro/reference/possum.html) data used in this exercise can be found in the [**openintro**](http://openintrostat.github.io/openintro) R package.]\n\n    $$\n    \\begin{aligned}\n    \\log_e \\bigg(\\frac{p}{1-p}\\bigg) = \\beta_0 &+ \\beta_1\\times \\texttt{tail_l}\n    \\end{aligned}\n    $$\n    \n    $$\n    \\begin{aligned}\n    \\log_e \\bigg(\\frac{p}{1-p}\\bigg) = \\beta_0 &+ \\beta_1\\times \\texttt{total_l} + \\beta_2\\times     \\texttt{sex}\n    \\end{aligned}\n    $$\n\n    ::: {.cell}\n    ::: {.cell-output-display}\n    ![](26-inf-model-logistic_files/figure-html/unnamed-chunk-21-1.png){width=90%}\n    :::\n    \n    ::: {.cell-output-display}\n    ![](26-inf-model-logistic_files/figure-html/unnamed-chunk-21-2.png){width=90%}\n    :::\n    :::\n    \n    a. How many observations are in Fold2?  Use the model with only tail length as a predictor variable. Of the observations in Fold2, how many of them were correctly predicted to be from Vicotria?  How many of them were incorrectly predicted to be from Victoria?\n     \n    b. How many observations are used to build the model which predicts for the observations in Fold2?\n    \n    c. For one of the cross-validation folds, how many coefficients were estimated for the model which uses tail length as a predictor?  For one of the cross-validation folds, how many coefficients were estimated for the model which uses total length and sex as predictors?\n    \n    \\clearpage\n\n1. **Possum classification, cross-validation to choose model.** \nIn this exercise we consider 104 brushtail possums from two regions in Australia (the first region is Victoria and the second is New South Wales and Queensland), where the possums may be considered a random sample from the population. \nWe use logistic regression to classify the possums into the two regions.\nThe outcome variable, called `pop`, takes value 1 when a possum is from Victoria and 0 when it is from New South Wales or Queensland.\n\n    $$\n    \\begin{aligned}\n    \\log_e \\bigg(\\frac{p}{1-p}\\bigg) = \\beta_0 &+ \\beta_1\\times \\texttt{tail_l}\n    \\end{aligned}\n    $$\n    \n    $$\n    \\begin{aligned}\n    \\log_e \\bigg(\\frac{p}{1-p}\\bigg) = \\beta_0 &+ \\beta_1\\times \\texttt{total_l} + \\beta_2\\times     \\texttt{sex}\n    \\end{aligned}\n    $$\n\n    ::: {.cell}\n    ::: {.cell-output-display}\n    ![](26-inf-model-logistic_files/figure-html/unnamed-chunk-22-1.png){width=90%}\n    :::\n    \n    ::: {.cell-output-display}\n    ![](26-inf-model-logistic_files/figure-html/unnamed-chunk-22-2.png){width=90%}\n    :::\n    :::\n\n    a. For the model with tail length, how many of the observations were correctly classified?  What proportion of the observations were correctly classified?\n    \n    b. For the model with total length and sex, how many of the observations were correctly classified?  What proportion of the observations were correctly classified?\n    \n    c. If you have to choose between using only tail length as a predictor versus using total length and sex as predictors (for classification into region), which model would you choose?  Explain.\n    \n    d. Given the predictions provided, what model might be preferable to either of the models given above?\n    \n    \\clearpage\n\n1.  **Premature babies, cross-validation.** \nUS Department of Health and Human Services, Centers for Disease Control and Prevention collect information on births recorded in the country.\nThe data used here are a random sample of 1000 births from 2014 (with some rows removed due to missing data).\nHere, we use logistic regression to model whether the baby is premature from various explanatory variables.^[The [`births14`](http://openintrostat.github.io/openintro/reference/births14.html) data used in this exercise can be found in the [**openintro**](http://openintrostat.github.io/openintro) R package.] [@data:births14]\n\n    $$\n    \\begin{aligned}\n    \\log_e \\bigg(\\frac{p}{1-p}\\bigg)  = \\beta_0 &+ \\beta_1\\times \\texttt{mage} + \\beta_2\\times     \\texttt{weight}\\\\\n    &+ \\beta_3 \\times \\texttt{mature} + \\beta_4 \\times \\texttt{visits}\\\\\n    &+ \\beta_5 \\times \\texttt{gained}+ \\beta_6 \\times \\texttt{habit}\\\\\n    \\end{aligned}\n    $$\n    \n    $$\n    \\begin{aligned}\n    \\log_e \\bigg(\\frac{p}{1-p}\\bigg)  = \\beta_0 &+ \\beta_1\\times \\texttt{weight} + \\beta_2\\times     \\texttt{mature}\n    \\end{aligned}\n    $$\n\n    ::: {.cell}\n    ::: {.cell-output-display}\n    ![](26-inf-model-logistic_files/figure-html/unnamed-chunk-23-1.png){width=90%}\n    :::\n    \n    ::: {.cell-output-display}\n    ![](26-inf-model-logistic_files/figure-html/unnamed-chunk-23-2.png){width=90%}\n    :::\n    :::\n    \n    a. How many observations are in Fold2?  Use the model with only `weight` and `mature` as predictor variables. Of the observations in Fold2, how many of them were correctly predicted to be premature?  How many of them were incorrectly predicted to be premature?\n     \n    b. How many observations are used to build the model which predicts for the observations in Fold2?\n    \n    c. In the original dataset, are most of the births premature or full term?  Explain.\n    \n    d. For one of the cross-validation folds, how many coefficients were estimated for the model which uses `mage`, `weight`, `mature`, `visits`, `gained`, and `habit` as predictors?  For one of the cross-validation folds, how many coefficients were estimated for the model which uses `weight` and `mature` as predictors?\n    \n    \\clearpage\n\n1.  **Premature babies, cross-validation to choose model.** \nUS Department of Health and Human Services, Centers for Disease Control and Prevention collect information on births recorded in the country.\nThe data used here are a random sample of 1000 births from 2014 (with some rows removed due to missing data).\nHere, we use logistic regression to model whether the baby is premature from various explanatory variables. [@data:births14]\n\n    $$\n    \\begin{aligned}\n    \\log_e \\bigg(\\frac{p}{1-p}\\bigg)  = \\beta_0 &+ \\beta_1\\times \\texttt{mage} + \\beta_2\\times     \\texttt{weight}\\\\\n    &+ \\beta_3 \\times \\texttt{mature} + \\beta_4 \\times \\texttt{visits}\\\\\n    &+ \\beta_5 \\times \\texttt{gained}+ \\beta_6 \\times \\texttt{habit}\\\\\n    \\end{aligned}\n    $$\n    \n    $$\n    \\begin{aligned}\n    \\log_e \\bigg(\\frac{p}{1-p}\\bigg)  = \\beta_0 &+ \\beta_1\\times \\texttt{weight} + \\beta_2\\times     \\texttt{mature}\n    \\end{aligned}\n    $$\n\n    ::: {.cell}\n    ::: {.cell-output-display}\n    ![](26-inf-model-logistic_files/figure-html/unnamed-chunk-24-1.png){width=90%}\n    :::\n    \n    ::: {.cell-output-display}\n    ![](26-inf-model-logistic_files/figure-html/unnamed-chunk-24-2.png){width=90%}\n    :::\n    :::\n\n    a. For the model with 6 predictors, how many of the observations were correctly classified?  What proportion of the observations were correctly classified?\n    \n    b. For the model with 2 predictors, how many of the observations were correctly classified?  What proportion of the observations were correctly classified?\n    \n    c. If you have to choose between the model with 6 predictors and the model with 2 predictors (for predicting whether a baby will be premature), which model would you choose?  Explain.\n\n\n:::\n",
    "supporting": [
      "26-inf-model-logistic_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/bsTable-3.3.7/bootstrapTable.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/bsTable-3.3.7/bootstrapTable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}